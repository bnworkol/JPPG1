<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web UP</title>
    <link rel="icon" href="../assets/image/icon/LOGO.png" type="image/png">
    <link rel="stylesheet" href="./css/styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script>
    // Firebase configuration
    var firebaseConfig = {
  apiKey: "AIzaSyBx1NP4Ca_JNHU3MD9d9MwcOaSY6NO4Dg0",
  authDomain: "websitedd-fdc2b.firebaseapp.com",
  projectId: "websitedd-fdc2b",
  storageBucket: "websitedd-fdc2b.firebasestorage.app",
  messagingSenderId: "925232210062",
  appId: "1:925232210062:web:f46946a87e7c35639c69df",
    };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let userSessionUnsubscribe = null;
        let localSessionId = null;

        // ฟังก์ชันตรวจสอบสถานะการล็อกอินเมื่อหน้าเว็บโหลด
        firebase.auth().onAuthStateChanged(async function(user) {
            if (user) {
                // ผู้ใช้ล็อกอินอยู่
                const userSessionDoc = await db.collection('userSessions').doc(user.uid).get();
                if (userSessionDoc.exists && userSessionDoc.data().isLoggedIn) {
                    localSessionId = userSessionDoc.data().sessionId || null;

                    // ตั้งค่า listener สำหรับการเปลี่ยนแปลงใน userSessions
                    userSessionUnsubscribe = db.collection('userSessions').doc(user.uid)
                        .onSnapshot((doc) => {
                            if (doc.exists) {
                                const data = doc.data();
                                if (!data.isLoggedIn) {
                                    alert('คุณถูกล็อกเอาท์');
                                    logout(false);
                                } else if (data.sessionId !== localSessionId) {
                                    alert('คุณถูกล็อกเอาท์เนื่องจากมีการเข้าสู่ระบบจากอุปกรณ์อื่น');
                                    logout(false);
                                }
                            }
                        });
                    // แสดงเมนู
                    document.getElementById('login').classList.add('hidden');
                    document.getElementById('menu').classList.remove('hidden');
                } else {
                    // ถ้า isLoggedIn เป็น false ในฐานข้อมูล
                    await logout(false);
                }
            } else {
                // ผู้ใช้ไม่ได้ล็อกอิน
                document.getElementById('login').classList.remove('hidden');
                document.getElementById('menu').classList.add('hidden');
            }
        });

        // ฟังก์ชันเข้าสู่ระบบ
        async function login() {
            const email = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(async (userCredential) => {
                    // สร้าง sessionId ที่ไม่ซ้ำกัน
                    const sessionId = Date.now().toString();
                    localSessionId = sessionId;

                    await db.collection('userSessions').doc(userCredential.user.uid).set({
                        email: email,
                        isLoggedIn: true,
                        sessionId: sessionId
                    });

                    alert('เข้าสู่ระบบสำเร็จ');
                    document.getElementById('login').classList.add('hidden');
                    document.getElementById('menu').classList.remove('hidden');
                })
                .catch((error) => {
                    alert('เกิดข้อผิดพลาด: ' + error.message);
                });
        }

        // ฟังก์ชันออกจากระบบ
        async function logout(updateSession = true) {
            const user = firebase.auth().currentUser;
            if (user) {
                const uid = user.uid;
                if (userSessionUnsubscribe) {
                    userSessionUnsubscribe();
                    userSessionUnsubscribe = null;
                }

                if (updateSession) {
                    await db.collection('userSessions').doc(uid).update({
                        isLoggedIn: false,
                        sessionId: null
                    });
                }

                await firebase.auth().signOut();
            }

            alert('ออกจากระบบสำเร็จ');
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('login').classList.remove('hidden');
        }
    </script>
    
        <script>
      document.addEventListener('contextmenu', function(e) {
          e.preventDefault(); // ปิดการคลิกขวา
      });

      document.addEventListener('keydown', function(e) {
          // ปิดการเปิด Developer Tools ด้วย F12, Ctrl+Shift+I, Ctrl+U
          if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || (e.ctrlKey && e.keyCode === 85)) {
              e.preventDefault();
          }
      });
    </script>
    
</head>
<body>
    <div id="login">
        <h2>Login</h2>
        <input type="email" id="username" placeholder="Email"><br>
        <input type="password" id="password" placeholder="Password"><br>
        <button onclick="login()">Login</button>
    </div>

    <div id="menu" class="hidden">
        <div id="header">
            <button id="logout-button" onclick="logout()">Logout</button>
        </div>
        <h2>เอกสาร</h2>
        <div class="menu-container">
            <div class="menu-item" onclick="showSubMenu('submenu2')">
                <img src="./assets/image/picture/picture2.png" alt="เมนูหลั 2">
                <p>สลิปธนาคาร</p>
            </div>
            <div class="menu-item" onclick="showSubMenu('submenu4')">
                <img src="./assets/image/picture/picture4.png" alt="เมนูหลัก 4">
                <p>เทรดหุ้น</p>
            </div>
        </div>
    </div>

        <div id="submenu2" class="sub-menu hidden">
        <h2>สลิปธนาคาร</h2>
        <div class="menu-container">
            <div class="menu-item">
                <a href="src/slipk"><img src="./assets/image/picture/K1.png" alt="เมนูย่อย 1"></a>
                <p>สลิปกสิกรไทย</p>
            </div>
            <div class="menu-item">
                <a href="src/slipk_note"><img src="./assets/image/picture/K1.png" alt="เมนูย่อย 2"></a>
                <p>สลิปกสิกรไทย-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipb"><img src="./assets/image/picture/T1.png" alt="เมนูย่อย 5"></a>
                <p>สลิปกรุงเทพ</p>
            </div>
            <div class="menu-item">
                <a href="src/slipb_note"><img src="./assets/image/picture/T1.png" alt="เมนูย่อย 6"></a>
                <p>สลิปกรุงเทพ-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipt"><img src="./assets/image/picture/TT1.png" alt="เมนูย่อย 7"></a>
                <p>สลิปธนชาต</p>
            </div>
            <div class="menu-item">
                <a href="src/slipt_note"><img src="./assets/image/picture/TT1.png" alt="เมนูย่อย 8"></a>
                <p>สลิปธนชาต-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipktb"><img src="./assets/image/picture/KT1.png" alt="เมนูย่อย 3"></a>
                <p>สลิปกรุงไทย</p>
            </div>
            <div class="menu-item">
                <a href="src/slipktb_note"><img src="./assets/image/picture/KT1.png" alt="เมนูย่อย 4"></a>
                <p>สลิปกรุงไทย-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipbay"><img src="./assets/image/picture/B1.png" alt="เมนูย่อย 7"></a>
                <p>สลิปกรุงศรี</p>
            </div>
            <div class="menu-item">
                <a href="src/slipbay_note"><img src="./assets/image/picture/B1.png" alt="เมนูย่อย 8"></a>
                <p>สลิปกรุงศรี-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipscb"><img src="./assets/image/picture/S1.png" alt="เมนูย่อย 9"></a>
                <p>สลิปไทยพาณิชย์</p>
            </div>
            <div class="menu-item">
                <a href="src/slipscb_note"><img src="./assets/image/picture/S1.png" alt="เมนูย่อย 10"></a>
                <p>สลิปไทยพาณิชย์-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/GovernmentSavings"><img src="./assets/image/picture/Logo-o.png" alt="เมนูย่อย 9"></a>
                <p>สลิปออมสิน</p>
            </div>
            <div class="menu-item">
                <a href="src/GovernmentSavings_note"><img src="./assets/image/picture/Logo-o.png" alt="เมนูย่อย 10"></a>
                <p>สลิปออมสิน-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipkkp"><img src="./assets/image/picture/C1.png" alt="เมนูย่อย 9"></a>
                <p>สลิปเกียรตินาคินภัทร</p>
            </div>
            <div class="menu-item">
                <a href="src/slipkkp_note"><img src="./assets/image/picture/C1.png" alt="เมนูย่อย 10"></a>
                <p>สลิปเกียรตินาคินภัทร-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/make"><img src="./assets/image/picture/MAKE1.png" alt="เมนูย่อย 9"></a>
                <p>สลิปMake</p>
            </div>
            <div class="menu-item">
                <a href="src/make_note"><img src="./assets/image/picture/MAKE1.png" alt="เมนูย่อย 10"></a>
                <p>สลิปMake-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/sliplinebk"><img src="./assets/image/picture/BK.png" alt="เมนูย่อย 9"></a>
                <p>สลิปBK</p>
            </div>
            <div class="menu-item">
                <a href="src/sliplinebk_note"><img src="./assets/image/picture/BK.png" alt="เมนูย่อย 10"></a>
                <p>สลิปBK-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipa"><img src="./assets/image/picture/R1.png" alt="เมนูย่อย 9"></a>
                <p>สลิปธกส</p>
            </div>
            <div class="menu-item">
                <a href="src/slipa_note"><img src="./assets/image/picture/R1.png" alt="เมนูย่อย 10"></a>
                <p>สลิปธกส-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/slipcimb"><img src="./assets/image/picture/CIMB.png" alt="เมนูย่อย 9"></a>
                <p>สลิปซีไอเอสบี</p>
            </div>
            <div class="menu-item">
                <a href="src/slipcimb_note"><img src="./assets/image/picture/CIMB.png" alt="เมนูย่อย 10"></a>
                <p>สลิปซีไอเอสบี-บันทึก</p>
            </div>
            <div class="menu-item">
                <a href="src/A-IOS1"><img src="./assets/image/picture/ios.png" alt="เมนูย่อย 9"></a>
                <p>IOS1</p>
            </div>
            <div class="menu-item">
                <a href="src/A-IOS2"><img src="./assets/image/picture/ios.png" alt="เมนูย่อย 10"></a>
                <p>IOS2</p>
            </div>
            <div class="menu-item">
                <a href="src/A-android1"><img src="./assets/image/picture/ios.png" alt="เมนูย่อย 10"></a>
                <p>android1</p>
            </div>
        </div>
        
        <h2>เงินเข้าธนาคาร</h2>
        <div class="menu-container">
            <div class="menu-item">
                <a href="src/Depositkbank"><img src="./assets/image/picture/K1.png" alt="เมนูย่อย 1"></a>
                <p>เงินเข้ากสิกรไทย(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositkbank2"><img src="./assets/image/picture/K1.png" alt="เมนูย่อย 1"></a>
                <p>เงินเข้ากสิกรไทย(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositkbank3"><img src="./assets/image/picture/K1.png" alt="เมนูย่อย 1"></a>
                <p>เงินเข้ากสิกรไทย(3)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositkbank4"><img src="./assets/image/picture/K1.png" alt="เมนูย่อย 1"></a>
                <p>เงินเข้ากสิกรไทย(ถอนยอด2)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositkbank5"><img src="./assets/image/picture/KL.png" alt="เมนูย่อย 10"></a>
                <p>Kbank Live(เข้า/ออก)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositBangkok"><img src="./assets/image/picture/T1.png" alt="เมนูย่อย 2"></a>
                <p>เงินเข้ากรุงเทพ(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositBangkok2"><img src="./assets/image/picture/T1.png" alt="เมนูย่อย 2"></a>
                <p>เงินเข้ากรุงเทพ(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositThanachart"><img src="./assets/image/picture/TT1.png" alt="เมนูย่อย 3"></a>
                <p>เงินเข้าTTB(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositThanachart2"><img src="./assets/image/picture/TT1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าTTB(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositThanachart3"><img src="./assets/image/picture/TT1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าTTB(3)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositKrungthai"><img src="./assets/image/picture/KT1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงไทย(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositKrungthai2"><img src="./assets/image/picture/KT1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงไทย(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositKrungthai3"><img src="./assets/image/picture/KT1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงไทย(3)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositKrungthai4"><img src="./assets/image/picture/KT1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงไทย(ถอนยอด2)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositbay"><img src="./assets/image/picture/B1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงศรี(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositbay3"><img src="./assets/image/picture/B1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงศรี(ถอนยอด2)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositbay2"><img src="./assets/image/picture/B1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้ากรุงศรี(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositscb"><img src="./assets/image/picture/S1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าไทยพาณิชย์(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositscb2"><img src="./assets/image/picture/S1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าไทยพาณิชย์(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositscb3"><img src="./assets/image/picture/S1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าไทยพาณิชย์(2ยอด)</p>
            </div>
            <div class="menu-item">
                <a href="src/Deposito"><img src="./assets/image/picture/Logo-o.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าออมสิน(1)</p>
            </div>
            <div class="menu-item">
                <a href="src/Deposito2"><img src="./assets/image/picture/Logo-o.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าออมสิน(2)</p>
            </div>
            <div class="menu-item">
                <a href="src/DepositKKP"><img src="./assets/image/picture/C1.png" alt="เมนูย่อย 9"></a>
                <p>เงินเข้าเกียรตินาคินภัทร</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositmake1"><img src="./assets/image/picture/MAKE1.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าMake</p>
            </div>
            <div class="menu-item">
                <a href="src/Depositbk1"><img src="./assets/image/picture/BK.png" alt="เมนูย่อย 4"></a>
                <p>เงินเข้าBK</p>
            </div>
            <div class="menu-item">
                <a href="src/Deposita1"><img src="./assets/image/picture/R1.png" alt="เมนูย่อย 9"></a>
                <p>สลิปธกส</p>
            </div>
            <div class="menu-item">
                <a href="#"><img src="./assets/image/picture/FREE.png" alt="เมนูย่อย 5"></a>
                <p>ว่าง</p>
            </div>
        </div>
        
        
        <button onclick="backToMenu()">Back</button>
    </div>
  
    
        <div id="submenu4" class="sub-menu hidden">
        <h2>เทรดหุ้น</h2>
        <div class="menu-container">
            <div class="menu-item">
                <a href="src/reserve"><img src="./assets/image/picture/R.png" alt="เมนูย่อย 8"></a>
                <p>ใบจองสินค้า</p>
            </div>
            <div class="menu-item">
                <a href="src/Evaluate"><img src="./assets/image/picture/picturepass.png" alt="เมนูย่อย 8"></a>
                <p>ประเมินภาพ</p>
            </div>
        </div>
        <button onclick="backToMenu()">Back</button>
    </div>

    <script src="./app/script.js"></script>
</body>
</html>
